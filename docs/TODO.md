# TODO (MLDSL Compiler)

Format: `id | task | priority | owner | needs_user_test | state | links`

- COMP-001 | Keep parser/output aligned with mod page-aware print expectations | P0 | agent | yes | in_progress | docs/CROSS_PROJECT_INDEX.md
- COMP-002 | Add donor-tier summary in compile output using shared id rules | P1 | agent | yes | open | donaterequire integration
- COMP-003 | Add strict schema validation for emitted plan.json | P1 | agent | no | open | tests/
- COMP-004 | Keep generated docs/aliases deterministic in CI | P1 | agent | no | in_progress | .github/workflows/ci.yml
- COMP-005 | Add docs scope guardrail to prevent mod/site doc drift | P1 | agent | no | done | tools/check_docs_scope.py
- COMP-006 | Lock plan/export compatibility test vectors for modern runtime-core adapters (1.16.5/1.20/1.21) | P0 | agent | yes | open | docs/CROSS_PROJECT_INDEX.md
- COMP-007 | Add regression test for action resolver fallback precedence (`sign1+sign2` must dominate `sign1` chest-based fallback) | P1 | agent | no | done | tests/test_exportcode_contract.py
- COMP-008 | Add regression test for empty sign diagnostics (`sign1/sign2/gui/menu` all empty -> explicit warning) | P1 | agent | no | done | tests/test_exportcode_contract.py
- COMP-009 | Clarify chest-autopick warning by logging alias transition (`from module.alias -> to module.alias`) + regression test | P1 | agent | no | done | mldsl_exportcode.py, tests/test_exportcode_contract.py
- COMP-010 | Preserve variable tokens in export arg reconstruction (`TEXT`/`APPLE`/mixed modes), avoid forced stringification | P0 | agent | no | done | mldsl_exportcode.py, tests/test_exportcode_contract.py
- COMP-011 | Preserve special apple location tokens (`LOC_NAME`) as raw args (no text quoting/book coercion) | P0 | agent | no | done | mldsl_exportcode.py, tests/test_exportcode_contract.py
- COMP-012 | Normalize APPLE constants to `apple.<TOKEN>` while preserving already-prefixed values | P0 | agent | no | done | mldsl_exportcode.py, tests/test_exportcode_contract.py
- COMP-013 | Align `select.ifplayer/ifmob/ifentity` selector resolution with `if_player` naming and remove mob/entity ambiguity in same-leaf selectors | P0 | agent | no | done | mldsl_compile.py
- COMP-014 | Render `Выбрать объект` as `select.*` in exportcode translator (with `ifplayer/ifmob/ifentity` domain mapping) | P0 | agent | no | done | mldsl_exportcode.py, tests/test_exportcode_contract.py
- COMP-015 | Make `mldsl exportcode` default api_aliases path independent from current working directory | P0 | agent | no | done | mldsl_cli.py
- COMP-016 | Export world events (`Событие мира`/gold block) as `event(...)` instead of fallback `row(...)` | P0 | agent | no | done | mldsl_exportcode.py, tests/test_exportcode_contract.py
- COMP-017 | Ignore technical `minecraft:air` placeholders during exportcode row call rendering | P0 | agent | no | done | mldsl_exportcode.py, tests/test_exportcode_contract.py
- COMP-018 | Add assignment sugar (`+=`, `-=`, `*=`, `/=`) in compiler | P0 | agent | no | done | mldsl_compile.py
- COMP-019 | Treat bare identifiers in TEXT params as variable refs by default (`var(...)`) | P0 | agent | yes | done | mldsl_compile.py
- COMP-020 | Compatibility shim for `if_value.переменная_существует(var)` -> mirror to `var2` | P1 | agent | yes | done | mldsl_compile.py
- COMP-021 | Deduplicate mirrored params in api_aliases for `Если переменная | Переменная существует` (remove synthetic `var2`) | P0 | agent | yes | done | tools/build_api_aliases.py
- COMP-022 | Stabilize fallback arg-slot detection in `extract_regallactions_args.py` using row-aligned bounds + nearest-lower-first fallback | P0 | agent | yes | done | extract_regallactions_args.py
- COMP-023 | Deduplicate mirrored params in api_aliases for conditional-object `Переменная существует` (`Игрок/Моб/Сущность по условию`) | P0 | agent | yes | done | tools/build_api_aliases.py
- COMP-024 | Canonicalize conditional select actions in api_aliases to `select.ifplayer_* / ifmob_* / ifentity_*` with legacy alias bridge | P0 | agent | yes | done | tools/build_api_aliases.py
- COMP-025 | Add `meta.paramSource` (`raw|normalized`) to api_aliases specs and show source in helper hover footer | P1 | agent | yes | done | tools/build_api_aliases.py, local.mldsl-helper extension.js
- COMP-026 | Add regression tests for var-exists dedup across `if_value` + `select.if*` and negative control | P0 | agent | no | done | tests/test_api_aliases_dedup.py
- COMP-027 | Add compiler regression tests for select-sugar bridge (`select.if_player.*`) and assignment sugar (`+= -= *= /=`) | P1 | agent | no | done | tests/test_compile_select_and_sugar.py
- COMP-028 | Fix compiler `select` module resolution (`misc.vybrat_*` regression) with legacy fallback bridge | P0 | agent | yes | done | mldsl_compile.py
- COMP-029 | Preserve critical raw generator inputs in repo (`seed/inputs/regallactions_export.txt`, `seed/inputs/apples.txt`) and wire fallback path resolution | P0 | agent | no | done | seed/inputs/, mldsl_paths.py
- COMP-030 | Stabilize generator architecture: single SoT `tools/build_api_aliases.py` + api_aliases contract validation + build consistency tests | P0 | agent | no | done | build_api_aliases.py, tools/build_api_aliases.py, tests/test_build_pipeline_contract.py
- COMP-031 | Add `vfunc` compile-time expansion (top-level macro functions with defaults, fail-fast recursion/conflict checks) | P0 | agent | yes | done | mldsl_compile.py, tests/test_vfunc_expansion.py, README.md
- COMP-032 | Fix select sugar compile path to canonical `select` module and add alias bridge for `сравнить_число_легко` | P0 | agent | yes | done | mldsl_compile.py
- COMP-033 | Harden compiler call parsing: support multiline `module.func(...)` and omit empty named arg values (`var=`) from emitted plan args | P0 | agent | yes | done | mldsl_compile.py, tests/test_compile_call_parsing.py
- COMP-034 | Fix VSCode helper select completion module routing (`select.ifplayer/ifmob/ifentity`) to use canonical `select` aliases instead of legacy `misc` | P0 | agent | yes | done | tools/mldsl-vscode/extension.js
- COMP-035 | Reduce VSCode helper completion visual noise for `select.*` by hiding long canonical alias variants in right-side detail | P1 | agent | yes | done | tools/mldsl-vscode/extension.js
- COMP-036 | Remove parameter list from right-side completion detail for `select.*` entries in VSCode helper | P1 | agent | yes | done | tools/mldsl-vscode/extension.js
- COMP-037 | Show only canonical function id in right-side completion detail (remove module/signature alias noise) | P1 | agent | yes | done | tools/mldsl-vscode/extension.js
- COMP-038 | Add `multiselect` compile-time sugar with weighted condition operations (`+ - * /` and `+= -= *= /=`) and threshold comparison tail | P0 | agent | yes | done | mldsl_compile.py, tests/test_multiselect_expansion.py, README.md
- COMP-039 | Fix `multiselect` multiline condition parsing (`select.if*.foo(` across several lines) via generalized call normalization | P0 | agent | yes | done | mldsl_compile.py, tests/test_multiselect_expansion.py
- COMP-040 | Fix `multiselect` weighted op emission to match real `var.set_*` signatures (`var`,`num`) and add plan-output smoke verification | P0 | agent | yes | done | mldsl_compile.py, tests/test_multiselect_expansion.py
- COMP-041 | Add resilient regallactions lane parser for `Объединить текст(ы)` (4+glass lane + downward empty-column arg expansion) with occupied-slot rejection tests | P0 | agent | yes | done | extract_regallactions_args.py, tests/test_extract_regallactions_args_concat.py
- COMP-042 | Extend concat-text lane parser: include optional single gap column in arg expansion and virtual bottom-row scan for sparse exports | P0 | agent | yes | done | extract_regallactions_args.py, tests/test_extract_regallactions_args_concat.py
- COMP-043 | Generalize concat-text parser candidate filters (multi-field tolerant matching + structural fallback), including `=` action label support | P1 | agent | yes | done | extract_regallactions_args.py, tests/test_extract_regallactions_args_concat.py
- COMP-044 | Widen concat-lane matcher geometry: allow `3+gap+5` and `5+gap+3` (min run 3, total markers >=8) while keeping strict occupied-slot rejection | P1 | agent | yes | done | extract_regallactions_args.py, tests/test_extract_regallactions_args_concat.py
- COMP-045 | Relax concat-lane minimum total marker panes from 8 to 7 and verify full-catalog delta report | P2 | agent | yes | done | extract_regallactions_args.py, docs/STATUS.md
- COMP-046 | Add concat-lane `3+gap+1+gap+3` geometry support and validate no unexpected full-catalog deltas | P2 | agent | yes | done | extract_regallactions_args.py, tests/test_extract_regallactions_args_concat.py
- COMP-047 | Add `NOT/не` conditional negation support with `plan.json` `negated` flag and fail-fast validation on non-conditional actions | P0 | agent | yes | done | mldsl_compile.py, tests/test_not_negation_plan_flag.py
- COMP-048 | Fix compiler parsing for block-form `if_value.<condition>(...) { ... }` to prevent dropped conditions in emitted `plan.json` | P0 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-049 | Split default `data_root` by mode: dev checkout uses repo-local `out/`, production keeps `%LOCALAPPDATA%\\MLDSL` (portable unchanged) | P0 | agent | yes | done | mldsl_paths.py, tests/test_mldsl_paths_data_root.py
- COMP-050 | Emit bare identifiers in NUMBER params as `var(...)` (not `num(...)`) to avoid runtime constant coercion in numeric conditions | P0 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-051 | Add optional normalized multiline-call limit guard with reserved closing-brace budget (`MLDSL_NORMALIZED_CALL_LIMIT`) | P1 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-052 | Enforce plan row auto-split budget (`43` actions) with closing `}` marker (`skip`) counted in the same row limit | P0 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-053 | Emit compiler warning when row is auto-split by 43-action budget (stderr `[warn]` with split action index) | P1 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-054 | Change long-event row auto-split to call-chain equivalent (`42 + call(__autosplit_row_N)` + auto helper `func`) with collision-safe helper names | P0 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-055 | Prioritize semantic safety over split aggressiveness: split only at safe top-level points, selection-context guard for helper calls, and fail-fast when safe split is impossible | P0 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-056 | Add compile-safe fallback for events with no safe top-level split point: preserve order with in-event newline split (warned) instead of aborting compilation | P0 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-057 | Enforce leading scope header on continuation rows after auto-wrap/newline so no row starts with plain action block | P0 | agent | yes | done | mldsl_compile.py, tests/test_compile_select_and_sugar.py
- COMP-058 | Stabilize default test runs: isolate temporary `sys.path` changes in tests and restrict pytest discovery to `tests/` (exclude legacy `archive/`) | P1 | agent | no | done | tests/test_api_aliases_dedup.py, pytest.ini
- COMP-059 | Harden exportcode `select` alias emission to avoid generic/category aliases and force scoped `select.if*` rendering for canonical `select` module (incl. no-arg path) | P0 | agent | yes | done | mldsl_exportcode.py, tests/test_exportcode_contract.py
- COMP-060 | Fix repeated-number lane parsing for arithmetic set actions (`* + - /`) so `Число(а)` markers expand into virtual lower rows and preserve up to 28 numeric operands | P0 | agent | yes | done | tools/extract_regallactions_args.py, extract_regallactions_args.py, tests/test_extract_regallactions_args_concat.py
- COMP-061 | Relax repeated-number lane detector thresholds for arithmetic actions: `>=3` consecutive markers with `>=7` total markers in row | P1 | agent | yes | done | tools/extract_regallactions_args.py, extract_regallactions_args.py
- COMP-062 | Add repeated-text lane parsing for `текст содержит` actions (`Текст(ы)` markers with arrow lore) and expand virtual multiline TEXT args from lane columns | P0 | agent | yes | done | tools/extract_regallactions_args.py, extract_regallactions_args.py
- COMP-063 | Add repeated-item lane fallback selection for `Предмет(ы)` markers: validate 3 empty rows and choose alternative valid row when primary row is blocked (`Открыть меню` fix) | P0 | agent | yes | done | tools/extract_regallactions_args.py, extract_regallactions_args.py, tests/test_extract_regallactions_args_concat.py
- COMP-064 | Generalize repeated-lane parser across marker modes (`NUMBER/TEXT/ITEM/LOCATION/ARRAY/ANY`) with best-row selection and anti-mix fallback guards for 3+ marker actions | P0 | agent | yes | done | tools/extract_regallactions_args.py, extract_regallactions_args.py
- COMP-065 | Extend current repeated-lane parser to scan full lane span columns (including enum slots), register per-column only on successful empty-lane validation, and emit synthetic non-marker lane args | P0 | agent | yes | done | tools/extract_regallactions_args.py, extract_regallactions_args.py
- COMP-066 | Tighten repeated-lane span logic to atomic validation: register all lane columns only if vertical empty checks pass for every column in span (no partial lane registration) | P0 | agent | yes | done | tools/extract_regallactions_args.py, extract_regallactions_args.py
- COMP-067 | Add new parser mode `BLOCK`: detect from glass title containing `блок` (case-insensitive), propagate through alias generator naming, and support compiler wrapping as `item(...)` | P0 | agent | yes | done | tools/extract_regallactions_args.py, extract_regallactions_args.py, tools/build_api_aliases.py, mldsl_compile.py
- COMP-068 | Fix row auto-wrap accounting: include leading row header in 43-slot limit and reserve 1 slot after continuation-header injection to prevent 44-block overflow rows | P0 | agent | yes | done | mldsl_compile.py
- COMP-069 | Fix fallback newline auto-split under nested `if`: reserve row budget for runtime implicit closing pistons so emitted rows do not overflow 43-slot physical limit | P0 | agent | yes | done | mldsl_compile.py
- COMP-070 | Enforce strict scope-safe autosplit: disallow fallback row splitting inside open `{}` scopes and fail fast when no top-level split point exists within 43 budget | P0 | agent | yes | done | mldsl_compile.py
- COMP-071 | Smart autosplit for no-safe-boundary rows: extract nested `if` scope body into auto helper func and replace with in-scope `call(...)` to preserve brace semantics while fitting 43-slot rows | P0 | agent | yes | done | mldsl_compile.py
- COMP-072 | Fix synthetic array stack ops arg key mismatch (`number` -> canonical `num`) so index slots are emitted in plan for `get/remove/insert` array actions | P0 | agent | yes | done | mldsl_compile.py
